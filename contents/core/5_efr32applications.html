<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Applications of EFR32 I/O – Embedded Systems Design</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../contents/core/6_gesturerecog_realtime.html" rel="next">
<link href="../../contents/core/4_efr32programming.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-86daaaaad7353f9cc0c554efc1dd6d94.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-f8dc6eab18fde03278982b0b35885446.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-b4fc4dddb6ec1a779f0a285a431e56d0.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark-eae2d66f002e799350c2a60e45471621.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="../../site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="../../site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="../../site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "~",
    "/"
  ],
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Embedded Systems Design</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-wide tools-end">
    <a href="https://github.com/clarkson-edge/ee513_book" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="../../Embedded-Systems-Design.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" role="link" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://twitter.com/intent/tweet?url=|url|">
              <i class="bi bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
              <i class="bi bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/core/1_introduction.html">Embedded Systems Design</a></li><li class="breadcrumb-item"><a href="../../contents/core/5_efr32applications.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Applications of EFR32 I/O</strong></span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Embedded Systems Design</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/1_introduction.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/2_programmingwithc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title"><strong>Programming Embedded Systems with C</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/3_devkitoverview.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title"><strong>EFR32xG24 Development Kit Overview</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/4_efr32programming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><strong>EFR32 I/O Programming</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/5_efr32applications.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Applications of EFR32 I/O</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Embedded Machine Learning</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/6_gesturerecog_realtime.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Real-Time Gesture Recognition</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/7_gesturerecog_magicwand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title"><strong>Magic Wand via Gesture Recognition</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/8_anomalydetection_htm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title"><strong>IMU Anomaly Detection Using Hierarchical Temporal Memory</strong></span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../contents/core/9_audioml.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title"><strong>Audio ML for EFR32</strong></span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#segment-displays" id="toc-segment-displays" class="nav-link active" data-scroll-target="#segment-displays"><span class="header-section-number">5.1</span> 7-Segment Displays</a>
  <ul>
  <li><a href="#segments" id="toc-segments" class="nav-link" data-scroll-target="#segments"><span class="header-section-number">5.1.1</span> Segments</a></li>
  <li><a href="#wiring" id="toc-wiring" class="nav-link" data-scroll-target="#wiring"><span class="header-section-number">5.1.2</span> Wiring</a></li>
  <li><a href="#digit-display-logic" id="toc-digit-display-logic" class="nav-link" data-scroll-target="#digit-display-logic"><span class="header-section-number">5.1.3</span> Digit display logic</a></li>
  <li><a href="#display-driver-code" id="toc-display-driver-code" class="nav-link" data-scroll-target="#display-driver-code"><span class="header-section-number">5.1.4</span> Display driver code</a></li>
  <li><a href="#multiple-digits" id="toc-multiple-digits" class="nav-link" data-scroll-target="#multiple-digits"><span class="header-section-number">5.1.5</span> Multiple digits</a></li>
  <li><a href="#multiple-digits-logic" id="toc-multiple-digits-logic" class="nav-link" data-scroll-target="#multiple-digits-logic"><span class="header-section-number">5.1.6</span> Multiple digits logic</a></li>
  <li><a href="#exercise-displaying-hexadecimal-numbers" id="toc-exercise-displaying-hexadecimal-numbers" class="nav-link" data-scroll-target="#exercise-displaying-hexadecimal-numbers"><span class="header-section-number">5.1.7</span> Exercise: Displaying hexadecimal numbers</a></li>
  </ul></li>
  <li><a href="#parallel-lcd-displays" id="toc-parallel-lcd-displays" class="nav-link" data-scroll-target="#parallel-lcd-displays"><span class="header-section-number">5.2</span> Parallel LCD displays</a>
  <ul>
  <li><a href="#x2-character-lcd" id="toc-x2-character-lcd" class="nav-link" data-scroll-target="#x2-character-lcd"><span class="header-section-number">5.2.1</span> 16x2 Character LCD</a></li>
  <li><a href="#lcd-controller" id="toc-lcd-controller" class="nav-link" data-scroll-target="#lcd-controller"><span class="header-section-number">5.2.2</span> LCD Controller</a></li>
  <li><a href="#lcd-wiring" id="toc-lcd-wiring" class="nav-link" data-scroll-target="#lcd-wiring"><span class="header-section-number">5.2.3</span> LCD Wiring</a></li>
  <li><a href="#lcd-data-transfer" id="toc-lcd-data-transfer" class="nav-link" data-scroll-target="#lcd-data-transfer"><span class="header-section-number">5.2.4</span> LCD Data Transfer</a></li>
  <li><a href="#lcd-instructions" id="toc-lcd-instructions" class="nav-link" data-scroll-target="#lcd-instructions"><span class="header-section-number">5.2.5</span> LCD Instructions</a></li>
  <li><a href="#lcd-initialization" id="toc-lcd-initialization" class="nav-link" data-scroll-target="#lcd-initialization"><span class="header-section-number">5.2.6</span> LCD Initialization</a></li>
  <li><a href="#lcd-usage" id="toc-lcd-usage" class="nav-link" data-scroll-target="#lcd-usage"><span class="header-section-number">5.2.7</span> LCD Usage</a></li>
  <li><a href="#lcd-wait" id="toc-lcd-wait" class="nav-link" data-scroll-target="#lcd-wait"><span class="header-section-number">5.2.8</span> LCD Wait</a></li>
  <li><a href="#exercise-displaying-a-centered-string" id="toc-exercise-displaying-a-centered-string" class="nav-link" data-scroll-target="#exercise-displaying-a-centered-string"><span class="header-section-number">5.2.9</span> Exercise: Displaying a centered string</a></li>
  </ul></li>
  <li><a href="#keypad" id="toc-keypad" class="nav-link" data-scroll-target="#keypad"><span class="header-section-number">5.3</span> Keypad</a>
  <ul>
  <li><a href="#keypad-matrix-wiring" id="toc-keypad-matrix-wiring" class="nav-link" data-scroll-target="#keypad-matrix-wiring"><span class="header-section-number">5.3.1</span> Keypad Matrix Wiring</a></li>
  <li><a href="#reading-keypad-matrix" id="toc-reading-keypad-matrix" class="nav-link" data-scroll-target="#reading-keypad-matrix"><span class="header-section-number">5.3.2</span> Reading Keypad Matrix</a></li>
  <li><a href="#identifying-pressed-key" id="toc-identifying-pressed-key" class="nav-link" data-scroll-target="#identifying-pressed-key"><span class="header-section-number">5.3.3</span> Identifying Pressed Key</a></li>
  <li><a href="#power-efficiency" id="toc-power-efficiency" class="nav-link" data-scroll-target="#power-efficiency"><span class="header-section-number">5.3.4</span> Power Efficiency</a></li>
  <li><a href="#limitations-of-switch-matrix" id="toc-limitations-of-switch-matrix" class="nav-link" data-scroll-target="#limitations-of-switch-matrix"><span class="header-section-number">5.3.5</span> Limitations of Switch Matrix</a></li>
  <li><a href="#exercise-propose-a-solution-to-the-key-rollover-problem" id="toc-exercise-propose-a-solution-to-the-key-rollover-problem" class="nav-link" data-scroll-target="#exercise-propose-a-solution-to-the-key-rollover-problem"><span class="header-section-number">5.3.6</span> Exercise: Propose a solution to the key rollover problem</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/clarkson-edge/ee513_book/edit/dev/contents/core/5_efr32applications.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/clarkson-edge/ee513_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/clarkson-edge/ee513_book/blob/dev/contents/core/5_efr32applications.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../contents/core/1_introduction.html">Embedded Systems Design</a></li><li class="breadcrumb-item"><a href="../../contents/core/5_efr32applications.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Applications of EFR32 I/O</strong></span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title"><strong>Applications of EFR32 I/O</strong></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="chapterintro">
<p>Now that the basics of EFR32XG24 microcontroller input/output (I/O) are understood, the next step is learning how to add additional functionality to embedded systems using more complex hardware. This chapter will prepare readers to interact with more complex off-chip hardware using the microcontroller’s GPIO pins, and is an important step towards building user-friendly and effective embedded systems.</p>
</div>
<section id="segment-displays" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="segment-displays"><span class="header-section-number">5.1</span> 7-Segment Displays</h2>
<p>7-segment displays are commonly found in user-facing embedded systems, such as clock radios, household appliances, vehicles, and industrial equipment. While LED status indicators are often used for simple devices, they cannot communicate detailed information such as sensor readings or error codes. Gaining traction in the 1970s with the advent of LED technology, 7-segment displays bridge the gap between basic indicator lights and more complex graphic screens, commonly offering one or multiple digits composed of seven LED digit segments plus a decimal point or colon.</p>
<section id="segments" class="level3" data-number="5.1.1">
<h3 data-number="5.1.1" class="anchored" data-anchor-id="segments"><span class="header-section-number">5.1.1</span> Segments</h3>
<p>7-segment displays are composed of a group of LED segments arranged in an “8” pattern, allowing every digit from 0-9 plus a limited selection of letters to be readable.</p>
<p>These segments are commonly labeled A-G in a clockwise manner, with A being the top segment and G being the middle segment. Depending on the display, the segments may be wired in a common anode (LED positive terminal) or common cathode (LED negative terminal) configuration. Depending on the configuration, a slightly different circuit with inverted code logic may be necessary.</p>
<p>Additionally, as each segment is a simple LED, current-limiting resistors are a necessary inclusion in the circuit. In some cases, it may be acceptable to place a single resistor between in series with the common pin, especially if the resistor is of a high value to significantly limit the segment’s brightness. However, in most cases, it is ideal to adhere to the best practice of placing a current-limiting resistor in series with each <em>segment</em> so that manufacturing discrepancies between segments do not allow any individual segment to endanger itself with a high current.</p>
</section>
<section id="wiring" class="level3" data-number="5.1.2">
<h3 data-number="5.1.2" class="anchored" data-anchor-id="wiring"><span class="header-section-number">5.1.2</span> Wiring</h3>
<p>A 7-segment display will allocate a significant number of pins on a microcontroller, often using up nearly an entire GPIO port. If the decimal point is not used, one pin may be saved, but in many cases, it is beneficial to use a BCD to 7-segment decoder IC, such as the 74LS147, or even an 8-bit serial-in, parallel-out shift register such as the 74HC595 for greater GPIO pin efficiency. However, for the purposes of this guide, the 7-segment display will be directly connected to the microcontroller, using 8 GPIO pins.</p>
<p>In an ideal design, such as when building a PCB carrier board for the EFR32MG24 chip, a bank of pins such as PC00-PC07 may be used, allowing the GPIO port C MODEL register to be written in its entirety and full bytes written to the pin set and clear ports.</p>
<p>However, the EFR32XG24 Dev Kit board does not break out a single port in its entirety, therefore requiring the display to share pins between Port A and Port C. Segments A-E will use PC01-PC05, while F, G, and the decimal point (DP) will be connected to PA05-PA07, as displayed in Figure <a href="#fig:7-segment-wiring" data-reference-type="ref" data-reference="fig:7-segment-wiring">5.1</a>. This requires in code an array of GPIO ports and pins to look up the right one for a given segment:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// use gpioPortC (2) pins 1-5 for A-E, and gpioPortA (0) pins 5-7 for F, G, and DP</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">//                               A  B  C  D  E  F  G  .</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">uint8_t</span> segment_ports<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">uint8_t</span> segment_pins<span class="op">[]</span> <span class="op">=</span>  <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-segment-wiring.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1" title="Figure 5.1: Wiring diagram for a single common cathode 7-segment display"><img src="img/chapter5-segment-wiring.png" class="img-fluid figure-img" alt="Figure 5.1: Wiring diagram for a single common cathode 7-segment display"></a></p>
<figcaption>Figure 5.1: Wiring diagram for a single common cathode 7-segment display</figcaption>
</figure>
</div>
</section>
<section id="digit-display-logic" class="level3" data-number="5.1.3">
<h3 data-number="5.1.3" class="anchored" data-anchor-id="digit-display-logic"><span class="header-section-number">5.1.3</span> Digit display logic</h3>
<p>With these arrays created, the pattern of segments to enable for any character can now be defined. As there are eight segments in total, it makes sense to represent these patterns as bits in a byte, allowing for straightforward storage and lookup. To construct this byte, one may represent segment A as bit 0, B as bit 1, and so on until DP is bit 7. This results in Table <a href="#table:7segmentlookuptable" data-reference-type="ref" data-reference="table:7segmentlookuptable">5.1</a>, displaying the construction of hexadecimal codes for digits 0-9.</p>
<div id="table:7segmentlookuptable">
<table class="caption-top table">
<caption>Lookup table for 7-segment display digit codes</caption>
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: center;"><strong>Digit</strong></td>
<td style="text-align: center;"><strong>bit 7</strong></td>
<td style="text-align: center;"><strong>bit 6</strong></td>
<td style="text-align: center;"><strong>bit 5</strong></td>
<td style="text-align: center;"><strong>bit 4</strong></td>
<td style="text-align: center;"><strong>bit 3</strong></td>
<td style="text-align: center;"><strong>bit 2</strong></td>
<td style="text-align: center;"><strong>bit 1</strong></td>
<td style="text-align: center;"><strong>bit 0</strong></td>
<td style="text-align: center;"><strong>Hexadecimal</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><strong>.</strong></td>
<td style="text-align: center;"><strong>G</strong></td>
<td style="text-align: center;"><strong>F</strong></td>
<td style="text-align: center;"><strong>E</strong></td>
<td style="text-align: center;"><strong>D</strong></td>
<td style="text-align: center;"><strong>C</strong></td>
<td style="text-align: center;"><strong>B</strong></td>
<td style="text-align: center;"><strong>A</strong></td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>0</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x3F</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>1</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;"><strong>0x06</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>2</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x5B</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>3</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x4F</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>4</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;"><strong>0x66</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>5</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x6D</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>6</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x7D</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>7</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x07</strong></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><strong>8</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x7F</strong></td>
</tr>
<tr class="even">
<td style="text-align: center;"><strong>9</strong></td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;"><strong>0x6F</strong></td>
</tr>
</tbody>
</table>
</div>
<p>These hexadecimal codes for each digit can then be inserted into another array, with the array index mapping a desired digit to its segment code. In a later exercise, you will be required to expand this array to support hexadecimal digits as well.</p>
</section>
<section id="display-driver-code" class="level3" data-number="5.1.4">
<h3 data-number="5.1.4" class="anchored" data-anchor-id="display-driver-code"><span class="header-section-number">5.1.4</span> Display driver code</h3>
<p>Now that this look-up array for digits is implemented, driving the 7-segment display is trivial. Each GPIO pin in use must be set up as an output. Each pin may then be looped through, and set or cleared depending on if its corresponding bit in the hexadecimal code is set. This can be achieved by shifting the hexadecimal code right by the loop iterator variable, then evaluating based on the bitwise AND of the shifted code and 1.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> i<span class="op">++)</span> <span class="co">// loop through all segments</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">((</span>segments<span class="op">[</span>arbitrary_digit<span class="op">]</span> <span class="op">&gt;&gt;</span> i<span class="op">)</span> <span class="op">&amp;</span> <span class="dv">1</span><span class="op">)</span> <span class="co">// look up hex code, shift right, AND</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        GPIO<span class="op">-&gt;</span>P_SET<span class="op">[</span>segment_ports<span class="op">[</span>i<span class="op">]].</span>DOUT <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> segment_pins<span class="op">[</span>i<span class="op">];</span> <span class="co">// turn on segment</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>        GPIO<span class="op">-&gt;</span>P_CLR<span class="op">[</span>segment_ports<span class="op">[</span>i<span class="op">]].</span>DOUT <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> segment_pins<span class="op">[</span>i<span class="op">];</span> <span class="co">// turn off segment</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In this example, we use the <code>segments</code> array to loop up the hex code for a given <code>arbitrary_digit</code>, which could be an integer literal or a variable. The looked up code is shifted right based on the index of the current digit to be illuminated or turned off. With the bit of interest now moved to bit 0, it is compared with 1 to determine the appropriate state for the segment.</p>
</section>
<section id="multiple-digits" class="level3" data-number="5.1.5">
<h3 data-number="5.1.5" class="anchored" data-anchor-id="multiple-digits"><span class="header-section-number">5.1.5</span> Multiple digits</h3>
<p>In many applications, multiple 7-segment digits are necessary to display a larger number or other more detailed information. Even displaying time in a 12- or 24-hour format requires four digits. Therefore, it is often beneficial to combine multiple 7-segment displays into a single module, and these are commonly available in 2, 4, 6, or 8 digit configurations. However, using 8 GPIO pins per segment can quickly waste all available microcontroller pins. Instead, all digits in a module <em>multiplex</em>, or share, segment pins, which means that all segments, if illuminated at the same time, would show the same character. To facilitate this multiplexing, each digit has its own separate common cathode or common anode pin, which can be connected or disconnected to power. Each digit may then be lit one after another, with only one on at a given time, and this process is constantly repeated to create the effect that all digits are constantly on.</p>
<p>This does necessitate the use of an NPN transistor for each digit to switch the common pin load of the digit on and off, as the microcontroller cannot sink this significant current into a single GPIO. An example circuit is included in Figure <a href="#fig:multi-digit-7-segment-schematic" data-reference-type="ref" data-reference="fig:multi-digit-7-segment-schematic">5.2</a>, demonstrating the connections of a two-digit module with a common cathode configuration to an MCU.</p>
</section>
<section id="multiple-digits-logic" class="level3" data-number="5.1.6">
<h3 data-number="5.1.6" class="anchored" data-anchor-id="multiple-digits-logic"><span class="header-section-number">5.1.6</span> Multiple digits logic</h3>
<p>The same code may be used for driving multiple digits as a single digit; after all, the only difference is that the lit digit must be changed repeatedly. It is therefore ideal to move the single digit driver code to its own function so that it may be reused. The infinite loop must be adjusted to drive each digit’s transistor base pin high, then display a given digit, and finally switch the transistor back off before repeating the process for the next digit. This must be done quickly to avoid flicker at a frequency that is visible to the human eye, but not so quickly that the LEDs in each segment do not have time to reach their full brightness. Therefore, a few milliseconds of delay may be necessary while each digit is on before quickly switching to the next digit.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-segment-multi-schematic.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2" title="Figure 5.2: Two common-cathode 7-segment display digits switches by transistors"><img src="img/chapter5-segment-multi-schematic.png" class="img-fluid figure-img" alt="Figure 5.2: Two common-cathode 7-segment display digits switches by transistors"></a></p>
<figcaption>Figure 5.2: Two common-cathode 7-segment display digits switches by transistors</figcaption>
</figure>
</div>
</section>
<section id="exercise-displaying-hexadecimal-numbers" class="level3" data-number="5.1.7">
<h3 data-number="5.1.7" class="anchored" data-anchor-id="exercise-displaying-hexadecimal-numbers"><span class="header-section-number">5.1.7</span> Exercise: Displaying hexadecimal numbers</h3>
<p>Complete Table <a href="#table:7segmentlookuptable" data-reference-type="ref" data-reference="table:7segmentlookuptable">5.1</a> with the additional hexadecimal digits A-F, and expand the array. Then, try displaying 8-bit numbers in hexadecimal format with a two-digit 7-segment display module.</p>
</section>
</section>
<section id="parallel-lcd-displays" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="parallel-lcd-displays"><span class="header-section-number">5.2</span> Parallel LCD displays</h2>
<p>When more letters or symbols must be displayed to a user than is practical with a simple 7-segment display, or a graphical user interface is it is common to use a screen. Early computers generated signals to drive CRT screens, with a limited number of display lines and colors. Now, while full-color, high resolution monitors and other displays are widespread, it is still common to find smaller, often monochrome screens used in embedded systems due to their simplicity and minimal power consumption. In this section, we will learn about interfacing with a liquid crystal display (LCD) screen that can display two lines of 5x8 pixel characters. These low-cost displays are commonly found on budget 3D printers, control units for machinery, or in vehicle entertainment systems.</p>
<section id="x2-character-lcd" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="x2-character-lcd"><span class="header-section-number">5.2.1</span> 16x2 Character LCD</h3>
<p>An inexpensive character-based LCD module often contains 2-4 rows of 8-20 characters. In this case, the common LCD1602 module with 2 rows of 16 characters will be used. At the top of the display is a row of pins for powering and controlling the display. Table <a href="#table:16x2lcdpins" data-reference-type="ref" data-reference="table:16x2lcdpins">5.2</a> displays details for each pin, but most commonly found on these displays are power and ground for the display, a separate anode and cathode for the backlight LED, a contrast adjustment, and a number of data and control signals. To understand how to interface with the LCD, we must examine the display’s built in controller.</p>
</section>
<section id="lcd-controller" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="lcd-controller"><span class="header-section-number">5.2.2</span> LCD Controller</h3>
<p>The LCD module has an on-board Hitachi HD44780U controller that generates signals for the individual pixels of the display. The HD44780U is based on an original 1980s design, retaining command and feature parity while supporting modern microcontroller interfaces. It has two host-facing I/O registers as well as internal memory, meaning that data written to the display remains until it is next updated, reducing host MCU processor load. A 4- and 8-bit interface allows writing to, or reading from, both the instruction register or data register, which are used for configuration and character output, respectively. Therefore, these displays are known as using a parallel interface, as multiple bits of data are transferred at the same instant. More advanced displays may also offer additional interfaces that we will learn about later, such as I<sup>2</sup>C or SPI. It is important to read and understand the datasheet for the LCD controller to learn how to interface with it. The datasheet is linked here, but excerpts will be taken from it in this section: <a href="https://www.sparkfun.com/datasheets/LCD/HD44780.pdf" class="uri">https://www.sparkfun.com/datasheets/LCD/HD44780.pdf</a></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-lcd-pins.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3" title="Figure 5.3: Pinout for commonly available 16x2 LCD modules"><img src="img/chapter5-lcd-pins.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.3: Pinout for commonly available 16x2 LCD modules"></a></p>
</figure>
</div>
<figcaption>Figure 5.3: Pinout for commonly available 16x2 LCD modules</figcaption>
</figure>
</div>
<div id="table:16x2lcdpins">
<table class="caption-top table">
<caption>Table 5.2: Pin designations and descriptions for the 16x2 LCD display</caption>
<colgroup>
<col style="width: 12%">
<col style="width: 16%">
<col style="width: 70%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>Pin</strong></th>
<th style="text-align: left;"><strong>Symbol</strong></th>
<th style="text-align: left;"><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>1</strong></td>
<td style="text-align: left;"><strong>GND</strong></td>
<td style="text-align: left;">Display ground.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>2</strong></td>
<td style="text-align: left;"><strong>VCC</strong></td>
<td style="text-align: left;">Display power. Connect to 5V.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>3</strong></td>
<td style="text-align: left;"><strong>V0</strong></td>
<td style="text-align: left;">Display contrast adjustment. 0-5V range.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>4</strong></td>
<td style="text-align: left;"><strong>RS</strong></td>
<td style="text-align: left;">Register select. 0 for instructions, 1 for data.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>5</strong></td>
<td style="text-align: left;"><strong>R/W</strong></td>
<td style="text-align: left;">Read/write. 0 for write, 1 for read.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>6</strong></td>
<td style="text-align: left;"><strong>E</strong></td>
<td style="text-align: left;">Enable. Starts data read/write operation.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>7</strong></td>
<td style="text-align: left;"><strong>D0</strong></td>
<td style="text-align: left;">Data bit 0, used in 8-bit mode.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>8</strong></td>
<td style="text-align: left;"><strong>D1</strong></td>
<td style="text-align: left;">Data bit 1, used in 8-bit mode.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>9</strong></td>
<td style="text-align: left;"><strong>D2</strong></td>
<td style="text-align: left;">Data bit 2, used in 8-bit mode.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>10</strong></td>
<td style="text-align: left;"><strong>D3</strong></td>
<td style="text-align: left;">Data bit 3, used in 8-bit mode.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>11</strong></td>
<td style="text-align: left;"><strong>D4</strong></td>
<td style="text-align: left;">Data bit 4, used in 4-bit and 8-bit mode.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>12</strong></td>
<td style="text-align: left;"><strong>D5</strong></td>
<td style="text-align: left;">Data bit 4, used in 4-bit and 8-bit mode.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>13</strong></td>
<td style="text-align: left;"><strong>D6</strong></td>
<td style="text-align: left;">Data bit 4, used in 4-bit and 8-bit mode.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>14</strong></td>
<td style="text-align: left;"><strong>D7</strong></td>
<td style="text-align: left;">Data bit 4, used in 4-bit and 8-bit mode.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>15</strong></td>
<td style="text-align: left;"><strong>A</strong></td>
<td style="text-align: left;">Backlight LED anode. Connect to 5V.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>16</strong></td>
<td style="text-align: left;"><strong>K</strong></td>
<td style="text-align: left;">Backlight LED cathode. Connect to GND.</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="lcd-wiring" class="level3" data-number="5.2.3">
<h3 data-number="5.2.3" class="anchored" data-anchor-id="lcd-wiring"><span class="header-section-number">5.2.3</span> LCD Wiring</h3>
<p>As referenced above, these displays support both a 4-bit and an 8-bit data transfer mode, with the 8-bit data length allowing for faster and simpler transmissions while the 4-bit data length increases software complexity but requires fewer GPIO pins to be allocated.</p>
<p>In both cases, the display also requires three additional control signals, <code>RS</code>, <code>RW</code>, and <code>E</code>. The <code>RS</code> line selects between the instruction register (if set to 0), and the data register (if set to 1) of the HD44780 controller, allowing data sent to be interpreted as a command or a character to display. The <code>RW</code> line configures the data pins for read or write mode, from the perspective of the host MCU. Because the display will receive commands and data from the MCU most of the time, the <code>RW</code> line will often be 0, however, in some cases such as reading the address of the display cursor or the display’s busy signal, this line should be brought high. Finally, the <code>E</code>—or enable—signal causes a data transfer to occur. When writing to the display, the data and control lines should first be set up, and then the enable line quickly toggled on then back off, causing the HD44780U to accept the command or data.</p>
<p>In total, the 4-bit data mode will use a minimum of 7 GPIOs, and the 8-bit mode a minimum of 11 GPIOs. While they are not prohibitive, these are significant pin allocations for a single peripheral, and care must be taken when designing an embedded system to make good use of available pins.</p>
<p>Therefore, this section will take into account the additional complexity of the 4-bit data mode, making the 8-bit mode comparatively trivial to implement. To begin, the LCD should be connected to the EFR32XG24 Dev Kit as shown in the schematic in Figure <a href="#fig:lcdschematic" data-reference-type="ref" data-reference="fig:lcdschematic">5.4</a> and the wiring diagram in Figure <a href="#fig:lcdwiring" data-reference-type="ref" data-reference="fig:lcdwiring">5.5</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-lcd-schematic.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4" title="Figure 5.4: Schematic diagram of LCD connections to EFR32XG24 Dev Kit"><img src="img/chapter5-lcd-schematic.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.4: Schematic diagram of LCD connections to EFR32XG24 Dev Kit"></a></p>
</figure>
</div>
<figcaption>Figure 5.4: Schematic diagram of LCD connections to EFR32XG24 Dev Kit</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-lcd-wiring.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="Figure 5.5: Wiring diagram for LCD connections to EFR32XG24 Dev Kit"><img src="img/chapter5-lcd-wiring.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.5: Wiring diagram for LCD connections to EFR32XG24 Dev Kit"></a></p>
</figure>
</div>
<figcaption>Figure 5.5: Wiring diagram for LCD connections to EFR32XG24 Dev Kit</figcaption>
</figure>
</div>
</section>
<section id="lcd-data-transfer" class="level3" data-number="5.2.4">
<h3 data-number="5.2.4" class="anchored" data-anchor-id="lcd-data-transfer"><span class="header-section-number">5.2.4</span> LCD Data Transfer</h3>
<p>The LCD accepts command and data bytes on the four or eight connected data lines, on the falling edge of a single pulse of the enable line. The three control lines and all of the data lines must first be written to, so that the data on them is valid at the time of the enable line pulse. In 8-bit mode, each pulse of the enable line corresponds with a single instruction or data. However, in 4-bit mode, two consecutive writes or reads are necessary to transmit a full command. The command’s byte must be split into two nibbles—groups of four bits— and then transmitted with the most significant bits (MSBs) <code>7:4</code> first, followed by the least significant bits (LSBs) <code>3:0</code>. At the completion of the second data transfer, the LCD will execute the command and, after a brief period, be ready to accept more. The following code implements the protocol described above to send instructions or data to the LCD. Note that this code assumes that the control and data pins have already been configured as outputs.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> lcd_nibble_write<span class="op">(</span><span class="dt">uint8_t</span> data<span class="op">,</span> <span class="dt">uint8_t</span> register_select<span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    lcd_wait<span class="op">();</span> <span class="co">// wait until busy flag is not set (covered later in chapter)</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    GPIO<span class="op">-&gt;</span>P_CLR<span class="op">[</span>DATA_port<span class="op">]</span> <span class="op">=</span> DATA_mask<span class="op">;</span>               <span class="co">// clear data bits PC04-PC01</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    GPIO<span class="op">-&gt;</span>P_SET<span class="op">[</span>DATA_port<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>data <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">)</span> <span class="op">&amp;</span> DATA_mask<span class="op">;</span> <span class="co">// set data bits shifted onto the correct pins</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>register_select<span class="op">)</span> <span class="co">// data</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        GPIO<span class="op">-&gt;</span>P_SET<span class="op">[</span>CTRL_port<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> RS_pin<span class="op">;</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> <span class="co">// command</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        GPIO<span class="op">-&gt;</span>P_CLR<span class="op">[</span>CTRL_port<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> RS_pin<span class="op">;</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    GPIO<span class="op">-&gt;</span>P_SET<span class="op">[</span>CTRL_port<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> EN_pin<span class="op">;</span> <span class="co">// set enable</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    sl_sleeptimer_delay_millisecond<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    GPIO<span class="op">-&gt;</span>P_CLR<span class="op">[</span>CTRL_port<span class="op">]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> EN_pin<span class="op">;</span> <span class="co">// unset enable</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>lcd_nibble_write</code> function takes two arguments, the first being the data (whether it be an instruction or character) to transmit, and the second being a boolean for the register select line. First, the function checks the LCD busy flag to determine if the LCD controller is ready to accept new data. This function will be discussed later, and may be implemented or replaced with a delay. The data lines are then cleared so that any previously sent data does not interfere with the new data to be written. As the data is expected in the lower four bits of the data byte, it is shifted into the correct position on the port based on the wiring diagram. Depending on the wrapper code for this function, an additional masking of the data may be wise to avoid tampering with other GPIO pins. The register select pin is also written to match the <code>register_select</code> argument, and finally the enable line toggled to complete the transmission.</p>
</section>
<section id="lcd-instructions" class="level3" data-number="5.2.5">
<h3 data-number="5.2.5" class="anchored" data-anchor-id="lcd-instructions"><span class="header-section-number">5.2.5</span> LCD Instructions</h3>
<p>Sending a full command or character to the LCD just requires two calls to the already-implemented <code>lcd_nibble_write</code> function, one for each nibble that must be transmitted. It may be beneficial to write a wrapper function that does this automatically, requiring only the full byte of data, and potentially a register select argument to complete the entire process. This would involve shifting the data argument right four bits, calling <code>lcd_nibble_write</code> to transmit these MSBs, then masking out the upper four bits of the data argument and again calling <code>lcd_nibble_write</code>.</p>
<p>With the understanding of sending full commands to the LCD, it can now be properly initialized. To do so, it is necessary to consult the HD44780U datasheet to properly form the LCD commands. An excerpt from the datasheet is included in Figure <a href="#fig:lcdinstructions" data-reference-type="ref" data-reference="fig:lcdinstructions">5.6</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-lcd-instructions.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6" title="Figure 5.6: Instruction table for HD44780 (HD44780U Datasheet page 25)"><img src="img/chapter5-lcd-instructions.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.6: Instruction table for HD44780 (HD44780U Datasheet page 25)"></a></p>
</figure>
</div>
<figcaption>Figure 5.6: Instruction table for HD44780 (HD44780U Datasheet page 25)</figcaption>
</figure>
</div>
<p>Going through these instructions, it is clear that the command itself is determined by the place of the leftmost set bit.</p>
<p>The first couple of instructions at the top, Clear display and Return home, do not require arguments, and therefore require no bits lower than the leftmost set bit to change their behavior.</p>
<p>The next command, eEtry mode set, determines if the LCD’s internal DDRAM address counter is increased or decreased after a character is sent. The DDRAM address corresponds with the cursor position, so it is most common for bit 1 to be set for this command. Bit 0 in the entry mode set command controls if the display should be shifted, as in, the cursor remains in the same position on the display and all other letters scroll around it when a character is sent. This mode is sometimes useful for displaying a wide line of scrolling text.</p>
<p>The Display on/off control command allows the display itself, the cursor, and the cursor blinking to be turned on or off. Setting any of the argument bits for this command turns them on. For text entry, it is common for all three bits (<code>2:0</code>) to be set, giving a blinking cursor for the next character. For status or sensor reading displays, only bit 2 (entire display) should be set, as the cursor would be visually distracting in this case.</p>
<p>The Cursor or display shift command manually increments or decrements the cursor position, or shifts the entire display right or left. This may be used for a backspace action or for scrolling text.</p>
<p>The Function set command is important for initialization of the display. The data length bit (4) selects between 4- and 8-bit modes, with 0 representing 4 bits and 1 representing 8 bits. The value for this bit will depend on the wiring for the LCD chosen previously. The number of lines bit (3) configures the display controller for 1 or 2 lines of text, with 0 representing 1 line, and 1 representing 2 lines. The value for this bit should be chosen based on the LCD hardware in use. Finally, the character font bit (2) chooses between a 5x8 or 5x10 character font, and should also be chosen depending on the LCD’s capabilities.</p>
<p>The Set CGRAM address and Set DDRAM address are nearly identical, differing only in the number of bits available for the address and the RAM to write to. The CGRAM may be reconfigured while in operation with custom characters, and using the Set CGRAM address command is useful to select the custom character to overwrite. The DDRAM, which stores characters themselves that have been sent to the display, is more commonly used. Because the LCD DDRAM stores 80 character bytes, and the display is split into two lines, the second line begins at byte 40 of the DDRAM. This means that writing more than 16 characters on the first line will not automatically wrap to the second for many more characters; instead, the DDRAM address must be set to decimal 40 to begin the second line. For both commands, the address is specified in the bits lower than the leftmost set bit, and should be a valid address within the memory limits of the display controller.</p>
<p>The last command in the Figure <a href="#fig:lcdinstructions" data-reference-type="ref" data-reference="fig:lcdinstructions">5.6</a> instruction table requires the <code>R/W</code> bit to be set and the data lines used as inputs to the host MCU. This command allows the LCD busy flag to be read using bit 6 of the LCD controller’s response. It also allows for the host MCU to read the LCD controller’s address counter in the lower bits <code>5:0</code>.</p>
<p>When using the 4-bit data length, each of these commands must be constructed by the MCU, then split into the high-order and low-order nibbles to send sequentially to the LCD.</p>
</section>
<section id="lcd-initialization" class="level3" data-number="5.2.6">
<h3 data-number="5.2.6" class="anchored" data-anchor-id="lcd-initialization"><span class="header-section-number">5.2.6</span> LCD Initialization</h3>
<p>With all LCD commands accounted for, the LCD may now be initialized before use. Included in Figure <a href="#fig:lcdinitialization" data-reference-type="ref" data-reference="fig:lcdinitialization">5.7</a> is the steps necessary to initialize the LCD in 4-bit mode.</p>
<p>At power-up, every LCD character will be fully filled in, initialized, and cleared before characters can be written to it. Based on Figure <a href="#fig:lcdinitialization" data-reference-type="ref" data-reference="fig:lcdinitialization">5.7</a>, despite the LCD being automatically reset at power on, a manual reset sequence is necessary to synchronize the nibble transmissions. This reset sequence uses only <code>lcd_nibble_write</code>, as it is not yet ready to receive full commands. After this reset sequence is completed, the 4-bit mode, number of lines, and character size are then set in a single function set command, and further configuration commands may be used to clear the display, move the cursor, or adjust scrolling before characters are written to the LCD for the first time.</p>
</section>
<section id="lcd-usage" class="level3" data-number="5.2.7">
<h3 data-number="5.2.7" class="anchored" data-anchor-id="lcd-usage"><span class="header-section-number">5.2.7</span> LCD Usage</h3>
<p>Now that the LCD is initialized, characters may be written to the LCD by sending their ASCII codes, split up into 4-bit nibbles, to the LCD with the <code>RS</code> control line now set high. This will cause the LCD to write these characters into the DDRAM, where they are directly displayed.</p>
<p>Many effects may be created by combining the Set DDRAM address and cursor/display shift commands, including left, center, and right-aligned text, scrolling text, or even a small table of sensor readings.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-lcd-init.png" class="lightbox" data-gallery="quarto-lightbox-gallery-7" title="Figure 5.7: Block diagram of initialization sequence for HD44780U in 4-bit mode (HD44780U Datasheet page 46)"><img src="img/chapter5-lcd-init.png" class="img-fluid figure-img" alt="Figure 5.7: Block diagram of initialization sequence for HD44780U in 4-bit mode (HD44780U Datasheet page 46)"></a></p>
<figcaption>Figure 5.7: Block diagram of initialization sequence for HD44780U in 4-bit mode (HD44780U Datasheet page 46)</figcaption>
</figure>
</div>
</section>
<section id="lcd-wait" class="level3" data-number="5.2.8">
<h3 data-number="5.2.8" class="anchored" data-anchor-id="lcd-wait"><span class="header-section-number">5.2.8</span> LCD Wait</h3>
<p>The LCD’s busy flag can be read while it processes commands internally. To handle this, you can implement the <code>lcd_wait</code> function, which repeatedly reads the busy flag by setting R/W to 0 and configuring the data lines as input. When the function should wait in a while loop reading the busy flag until the LCD is again ready to accept commands. Calling <code>lcd_wait</code> should be done before sending any instructions or data to the LCD, to ensure that it is ready to receive data. Alternatively, you can use the <code>sl_sleeptimer_delay_ms</code> function to wait for a duration longer than any command processing requires. While this latter approach is simpler, it is less effective for high-frequency display updates due to the inherent required delay. For this technique, waiting for 2 milliseconds following any command is practical and easy to implement.</p>
</section>
<section id="exercise-displaying-a-centered-string" class="level3" data-number="5.2.9">
<h3 data-number="5.2.9" class="anchored" data-anchor-id="exercise-displaying-a-centered-string"><span class="header-section-number">5.2.9</span> Exercise: Displaying a centered string</h3>
<p>For this exercise, write a function that writes a c-string argument centered on the first line of the display. Check that the string passed to the function is no longer than 16 characters. With this condition met, calculate based on the length of the string the DDRAM address offset necessary to center the string.</p>
<p>For example, the string <code>EE260</code> is <span class="math inline">\(5\)</span> characters long. The number of characters that should be blank on the line is <span class="math inline">\(16-5=11\)</span>. To left align the text, the necessary offset is obviously <span class="math inline">\(0\)</span>. To right align the text, the offset should be <span class="math inline">\(11\)</span>, so that the <span class="math inline">\(5\)</span> additional characters are placed directly touching the right side of the display. To center align the text, the remaining blank characters must be divided by 2. An integer division of <span class="math inline">\(11/2=5\)</span> as the decimal is truncated, meaning that the necessary DDRAM offset is <span class="math inline">\(5\)</span>, which will leave <span class="math inline">\(6\)</span> characters to the right of the text.</p>
<p>The necessary DDRAM offset may then be set using the appropriate LCD command, then the characters of the string transferred to the display.</p>
<p>As an extension to this exercise, you may write a function that takes an additional argument to select the type of alignment and display line to place an arbitrary string of text on.</p>
</section>
</section>
<section id="keypad" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="keypad"><span class="header-section-number">5.3</span> Keypad</h2>
<p>Many embedded systems with user interfaces are controlled by simple inputs, such as a joystick, multifunctional knobs, or often, a group of buttons. In cases where many buttons are required, such as for numerical or even text input, connecting a single button to its own GPIO pin is inefficient. With a 4x4 grid of buttons requiring 16 pins, an I/O expander or separate microcontroller dedicated to I/O would likely be necessary. However, a clever arrangement of switches in a grid such as this allows for pins to be multiplexed, requiring a minimum of <span class="math inline">\(\sqrt{\text{\# of buttons}}\)</span> pins to read each button. This works by connecting one side of each switch to a common row, and the other side of the switch to a common column. For a 4x4 grid, only 8 pins are necessary to read the entire matrix layout.</p>
<section id="keypad-matrix-wiring" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="keypad-matrix-wiring"><span class="header-section-number">5.3.1</span> Keypad Matrix Wiring</h3>
<p>Commonly available matrix keypads simply implement the row and column switch connections to pushbuttons integrated in the module. Their pinout is often just a connection for each row and column, allowing them to easily be connected to GPIO pins on an MCU, as shown in Figure <a href="#fig:keypadwiring" data-reference-type="ref" data-reference="fig:keypadwiring">5.8</a>.</p>
<p>The internal connections of the keypad may be displayed differently depending on preferences for the schematic. However, it is common to see the switches aligned on a 45angle, bridging between their respective row and column common lines, as illustrated in Figure <a href="#fig:keypadschematic" data-reference-type="ref" data-reference="fig:keypadschematic">5.9</a>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-keypad-wiring.png" class="lightbox" data-gallery="quarto-lightbox-gallery-8" title="Figure 5.8: Pinout for an off-the-shelf keypad"><img src="img/chapter5-keypad-wiring.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.8: Pinout for an off-the-shelf keypad"></a></p>
</figure>
</div>
<figcaption>Figure 5.8: Pinout for an off-the-shelf keypad</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-keypad-schematic.png" class="lightbox" data-gallery="quarto-lightbox-gallery-9" title="Figure 5.9: Schematic diagram of a 4x4 pushbutton switch matrix"><img src="img/chapter5-keypad-schematic.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.9: Schematic diagram of a 4x4 pushbutton switch matrix"></a></p>
</figure>
</div>
<figcaption>Figure 5.9: Schematic diagram of a 4x4 pushbutton switch matrix</figcaption>
</figure>
</div>
</section>
<section id="reading-keypad-matrix" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="reading-keypad-matrix"><span class="header-section-number">5.3.2</span> Reading Keypad Matrix</h3>
<p>To read a matrix of switches, one axis should be connected to GPIO outputs. For example, we will connect the rows to output pins, writing all pins high to begin with. The other axis should be connected to internally pulled-down inputs, meaning that when any key is pressed, one of the high rows will be connected to the input, bringing it high. When this is detected, either with polling or an interrupt-based system, the microcontroller may now identify which key has been pressed.</p>
</section>
<section id="identifying-pressed-key" class="level3" data-number="5.3.3">
<h3 data-number="5.3.3" class="anchored" data-anchor-id="identifying-pressed-key"><span class="header-section-number">5.3.3</span> Identifying Pressed Key</h3>
<p>Once the MCU has been alerted that any key has been pressed, it may now scan the switch matrix to determine the specific key. To do this, all rows should be written low, except for the first row. This may be achieved in practice by writing all rows low first, then immediately writing the first row high. The MCU may then check if any key in the first row has been pressed by again reading all of the column inputs. If any of the column inputs are high, the currently checked row and column that is high correspond with the pressed key. Otherwise, the MCU must repeat the process, writing the next row low. In this way, the pressed key can quickly be determined, and other actions can be taken based on it. This process is outlined in Figure <a href="#fig:keypaddetectionflowchart" data-reference-type="ref" data-reference="fig:keypaddetectionflowchart">5.10</a>, a flowchart showing the logic necessary for efficient detection of keypresses.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="img/chapter5-keypad-flowchart.png" class="lightbox" data-gallery="quarto-lightbox-gallery-10" title="Figure 5.10: Flowchart for detecting any keypress, then identifying the speci ic key"><img src="img/chapter5-keypad-flowchart.png" class="img-fluid quarto-figure quarto-figure-center figure-img" alt="Figure 5.10: Flowchart for detecting any keypress, then identifying the speci ic key"></a></p>
</figure>
</div>
<figcaption>Figure 5.10: Flowchart for detecting any keypress, then identifying the speci ic key</figcaption>
</figure>
</div>
<p>A simplified sample implementation of this process is included below. The code implements nested-loop logic to scan a 4x4 matrix keypad using EFR32XG24 Dev Kit GPIO pins. First, the GPIO pins are initialized, with the column input pins (PC04–PC01) are configured as inputs, and the row output pins (PC05, PA07–PA05) are set to push-pull (output) mode. In the main loop, all the row pins are activated by setting them high. Then, if any of the column pins detects a high signal, representing a key press, the program iterates through each row to isolate the pressed key. During this process, all rows are brought low save for the current row of interest, and the program checks each column pin to identify the specific key pressed.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode c code-with-copy"><code class="sourceCode c"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">// column inputs are on PC04-PC01</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">uint8_t</span> row_ports<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">2</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span> <span class="co">// PC05, PA07-PA05 are row outputs</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">uint8_t</span> row_pins<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span>  <span class="co">// PC05, PA07-PA05 are row outputs</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    GPIO<span class="op">-&gt;</span>P<span class="op">[</span>gpioPortC<span class="op">].</span>MODEL <span class="op">|=</span> <span class="bn">0x1111</span> <span class="op">&lt;&lt;</span> <span class="op">(</span><span class="dv">1</span> <span class="op">*</span> <span class="dv">4</span><span class="op">);</span> <span class="co">// input mode</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        GPIO<span class="op">-&gt;</span>P<span class="op">[</span>row_ports<span class="op">[</span>i<span class="op">]].</span>MODEL <span class="op">|=</span> <span class="bn">0x4</span> <span class="op">&lt;&lt;</span> <span class="op">(</span>row_pins<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> <span class="dv">4</span><span class="op">);</span> <span class="co">// output mode</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            GPIO<span class="op">-&gt;</span>P_SET<span class="op">[</span>row_ports<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> row_pins<span class="op">[</span>i<span class="op">];</span> <span class="co">// set row pins</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>GPIO<span class="op">-&gt;</span>P<span class="op">[</span>gpioPortC<span class="op">].</span>DIN <span class="op">&amp;</span> <span class="bn">0xF</span> <span class="op">&lt;&lt;</span> <span class="dv">1</span><span class="op">)</span> <span class="co">// check if any key is pressed</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span> <span class="co">// loop through all columns</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>                    GPIO<span class="op">-&gt;</span>P_CLR<span class="op">[</span>row_ports<span class="op">[</span>j<span class="op">]]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> row_pins<span class="op">[</span>j<span class="op">];</span> <span class="co">// clear all row pins</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>                GPIO<span class="op">-&gt;</span>P_SET<span class="op">[</span>row_ports<span class="op">[</span>i<span class="op">]]</span> <span class="op">=</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> row_pins<span class="op">[</span>i<span class="op">];</span>     <span class="co">// set current row pin</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>                <span class="op">{</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>GPIO<span class="op">-&gt;</span>P<span class="op">[</span>gpioPortC<span class="op">].</span>DIN <span class="op">&lt;&lt;</span> <span class="dv">1</span> <span class="op">&amp;</span> <span class="dv">1</span> <span class="op">&lt;&lt;</span> i<span class="op">)</span> <span class="co">// check if column pin is high</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                    <span class="op">{</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>                        <span class="co">// this is the key pressed</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>                    <span class="op">}</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="power-efficiency" class="level3" data-number="5.3.4">
<h3 data-number="5.3.4" class="anchored" data-anchor-id="power-efficiency"><span class="header-section-number">5.3.4</span> Power Efficiency</h3>
<p>A key benefit of reading a switch matrix using this technique, especially with the EFR32MG24, which supports GPIO interrupts from all Energy Management levels. This means that the processor may go into its deepest sleep state while still waiting for keypresses from the matrix. This requires interrupt logic, which will be discussed later, but the general implementation is as follows:</p>
<p>The GPIO pins for the rows may be set high, and configured to retain their values while in sleep mode. An interrupt to wake the processor from sleep may be enabled on all input pins, meaning that any keypresses will now trigger the interrupt, waking the MCU from sleep. It can now progress directly into the key identification phase, finding the pressed key and performing an action before returning to low-power sleep.</p>
</section>
<section id="limitations-of-switch-matrix" class="level3" data-number="5.3.5">
<h3 data-number="5.3.5" class="anchored" data-anchor-id="limitations-of-switch-matrix"><span class="header-section-number">5.3.5</span> Limitations of Switch Matrix</h3>
<p>There exist a few limitations with this naive technique of reducing GPIO pin usage for a switch matrix, the most significant being the lack of <em>key rollover</em>. This means that the MCU cannot identify multiple keys being pressed, at least not with certainty.</p>
<p>Finally, if the keypress time is very short, a key pressed and caught by the detection routine may already be released and missed by the identification routine. This can be compounded by switch bouncing because many keyboard matrices lack hardware debouncing, while software debouncing requires keys to be pressed for a longer period of time before the press is registered.</p>
</section>
<section id="exercise-propose-a-solution-to-the-key-rollover-problem" class="level3" data-number="5.3.6">
<h3 data-number="5.3.6" class="anchored" data-anchor-id="exercise-propose-a-solution-to-the-key-rollover-problem"><span class="header-section-number">5.3.6</span> Exercise: Propose a solution to the key rollover problem</h3>
<p>Modern computer keyboards can detect any of their keys being pressed, as well as any combination of keys being pressed. To do this, they do not even require multiple I/O expanders or additional microcontrollers. Instead, there is electronic hardware integrated into the matrix circuit in series with every switch that ensures the proper key is detected.</p>
<p>What could this hardware be? Explain how it may be used to support multiple simultaneous keypresses.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../contents/core/4_efr32programming.html" class="pagination-link" aria-label="**EFR32 I/O Programming**">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title"><strong>EFR32 I/O Programming</strong></span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../contents/core/6_gesturerecog_realtime.html" class="pagination-link" aria-label="Real-Time Gesture Recognition">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Real-Time Gesture Recognition</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>Written by Masudul Imtiaz, PhD (Clarkson University)</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/clarkson-edge/ee513_book/edit/dev/contents/core/5_efr32applications.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/clarkson-edge/ee513_book/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li><li><a href="https://github.com/clarkson-edge/ee513_book/blob/dev/contents/core/5_efr32applications.qmd" class="toc-action"><i class="bi empty"></i>View source</a></li></ul></div></div>
    <div class="nav-footer-right">
<p>This book was built with <a href="https://quarto.org/">Quarto</a>.</p>
</div>
  </div>
</footer>
<script>var lightboxQuarto = GLightbox({"closeEffect":"zoom","descPosition":"bottom","loop":false,"openEffect":"zoom","selector":".lightbox"});
(function() {
  let previousOnload = window.onload;
  window.onload = () => {
    if (previousOnload) {
      previousOnload();
    }
    lightboxQuarto.on('slide_before_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      const href = trigger.getAttribute('href');
      if (href !== null) {
        const imgEl = window.document.querySelector(`a[href="${href}"] img`);
        if (imgEl !== null) {
          const srcAttr = imgEl.getAttribute("src");
          if (srcAttr && srcAttr.startsWith("data:")) {
            slideConfig.href = srcAttr;
          }
        }
      } 
    });
  
    lightboxQuarto.on('slide_after_load', (data) => {
      const { slideIndex, slideNode, slideConfig, player, trigger } = data;
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(slideNode);
      }
    });
  
  };
  
})();
          </script>




</body></html>